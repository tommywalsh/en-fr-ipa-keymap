# en-fr-ipa-keymap
A custom American English keymap with added characters from French and the International Phonetic Alphabet.

## Usage
So long as you never touch the right "super" (aka "Windows") or "context menu" keys, this behaves just like an ordinary
US English keyboard. Activing either or both of these keys gives access to French, IPA, and other characters.

### French Characters

Of course, most French characters are also English characters, and so for those, you just type them normally.  The right
"super" key is used to access additional characters that are used in French but not English.

#### Ligatures and Guillemets
Ligatures and guillemets are generated by holding down the right "super" key while hitting another key related to the symbol:

|Right "alt" plus this key... | ... generates this character |
|:---------------------------:|:----------------------------:|
|          o                  |              œ               |
|          a                  |              æ               |
|         < (shift-comma)     |              «               |
|         > (shift-period)    |              »               |

#### Accented Letters
Accented letters are generated using a two-step sequence. First, you hold down the right "super" while hitting the
key corresponding to the accent (see below). Then, you type the key of the letter you want the accent to appear on.

| For this accent | Use right "alt" plus: |
|:---------------:|:---------------------:|
| aigu (é)        | single-quote (')      |
| grave (è)       | backtick (`)          |
| circonflex (ê)  | carat (^)             |
| tréma (ë)       | double-quote (")      |
| cédille (ç)     | comma (,)             |


#### Other European Characters
This keyboard definition also offers a handful of other characters that are European, but not necessarily French.
Again, they are accessed with the right "super" key. These include the Euro symbol (super+e), the inverted question
mark (super+question), and characters accented with a tilde, like "ñ".

### IPA characters

This keyboard supports almost all of the IPA characters used in the pronunciation of American English and Parisian French,
with some exceptions mentioned below.

Some of these IPA characters (e.g. f, a) are also English letters, so you can just type them normally.
Some others (e.g. œ, æ) are also French characters, so you generate them using the French rules above.

#### Nasal Vowels

The nasal vowel symbols are accessed using the same two-step sequence as the French accented characters.
First, hold down right "super" while hitting the tilde key. Next, hit the "a" "e" or "o" key. This will
generate the character ã, ẽ, or õ respectively.

Note that these characters are technically incorrect. The correct symbols would be ɑ̃, ɛ̃, and ɔ̃. I could not figure
out a good way to generate these symbols, so I decided to settle for ã, ẽ, and õ.  

#### Other IPA Characters

The right "context menu" key is used to generate the remaining supported IPA characters, by hitting the key that most
closely resembles the character (potentially also with the shift key)

#### Table

Here is a full table of the IPA symbols supported by this keymap.

| IPA Symbol  | English Example | French Example | How To Type |
|:-----------:|:---------------:|:--------------:|:-----------:|
|    æ        |     s**a**t     |                | rsuper+a      |
|    ɑ        |     sp**a**     |   ç**a**       | menu+a     |
|    ã        |                 |  mam**an**     | rsuper+~,a    |
|    ɛ        |     s**e**t     |   s**ai**t     | menu+shift+e|
|    ə        |    **a**head    |  b**e**soin    | menu+e     |
|    e        |                 |  c'**e**st     |   e         |
|    ẽ        |                 |   l**oin**     | rsuper+~,e    |
|    i        |  s**ee**        |  **i**c**i**   |   i         |
|    ɪ        |     s**i**t     |                | menu+i     |
|    o        |                 |  **au**cune    |   o         |
|    ø        |                 |  c**eu**x      | menu+o     |
|    ɔ        |   s**augh**t    |  s**o**rt      | rctlr+shift+o |
|    œ        |                 |  s**œ**ur      | rsuper+o      |
|    õ        |                 |  s**on**       | rsuper+~,o    |
|    u        |     s**ue**     |  s**ou**s      |   u         |
|    ʊ        |    s**oo**t     |                | menu+u     |
|    ʌ        |     s**u**b     |                | menu+shift+u |
|    y        |                 |   s**u**       |   y         |
|    b        |     **b**at     | **b**anque     |   b         |
|    d        |    **d**ebt     | **d**evoirs    |   d         |
|    ð        |    **th**is     |                | rcrtl+d     |
|   dʒ        |     **j**ar     | bu**dg**et     |  d,rcrtl+z  |
|    f        |    dea**f**     | ca**f**ard     |   f         |
|    g        |    **g**ive     | ba**g**ue      |   g         |
|    h        |    **h**ave     |                |   h         |
|    ɥ        |                 | l**u**i        | menu+h     |
|    j        |   **y**ellow    | ta**ill**e     |   j         |
|    k        |     **c**ar     | **c**ave       |   k         |
|    l        |   be**l**ieve   | **l**es        |   l         |
|    m        |   **m**arket    | **m**onter     |   m         |
|    n        |    **n**eck     | A**nn**e       |   n         |
|    ŋ        |    si**ng**     | oi**gn**on     | menu+n     |
|    ɲ        |                 | ga**gn**er     | menu+shift+n |
|    p        |   ri**pp**ed    | **p**âte       |   p         |
|    ʁ        |                 | qua**r**ante   | menu+r     |
|    ɹ        |    **r**ave     |                | menu+shift+r |
|    s        |    **s**end     | ba**ss**e      |   s         |
|    ʃ        |    **sh**ow     | **ch**amp      | menu+s     |
|    t        |     me**t**     | bo**tt**e      |   t         |
|   tʃ        | **ch**ur**ch**  | **Tch**èque    | t,menu+s   |
|    θ        |    **th**in     |                | menu+t     |
|    v        |    se**v**en    | **v**ert       |   v         |
|    w        |   **w**eevil    | **ou**est      |   w         |
|    z        |    **z**ebra    | va**s**e       |   z         |
|    ʒ        |  trea**s**ure   | **j**e         | menu+z     |


#### Missing characters
This keymap does not support the following English/French IPA characters:

- **œ̃** Nasal vowel used in Quebec and some other places (but not in Parisian French)
- **ʔ**: Glottal stop used in some UK accents, (e.g. in place of /t/ in "butter")


### Other characters
A handful of other symbols, mostly for currency, math, and science, are accessible by using **both** the "right super"
and "context menu" keys at the same time.

## Code Layout
This was hacked together very quickly, with not much care put into portability.

There are two system files of note: 
  
  - The "us" symbols file, which defines a set of keyboard mappings that specify which symbols are associated with which
    keystrokes. We need to add a new mapping definition to this file

  - The "evdev" rules XML file. I'm not 100% clear on EXACTLY what this file's job is, but it appears to be involved in 
    indexing the keyboard mappings. It's unclear if this indexing is actually used by the XKB system, or if it's just
    a convenience for keyboard-picker UIs. Note that there are a few "evdev" files, and they each have an analogue 
    called "base". It's my understanding that "evdev" is used until Linux. I'm not sure which systems use "base",
    or if any in fact still do.

The new keyboard definition is in the local file `custom.keymap`. The contents of this file need to be inserted into the
system "us" keymap file.

The code to handle interacting with the system files is in the local file `src/system_integration.py`.

This code is activated by running either `build.sh` or `install.sh`.


## Building and installing
First, run `build.sh`.  This will make local copies of the two system files that need to be modified (to the `ingested`
directory).  Then, new local versions of these files will be generated with the required modification (in the 
`generated` directory).

Next, run `install.sh`. This will use `sudo` to get privileges, then will backup the original system files, then will
install the newly-generated versions of those system files.

There are some protections against accidentally running these commands in the incorrect order, and against overwriting
the backups of the original system files. No guarantees that this will always work.

This whole process works fine on my system. It may or may not work on yours.
